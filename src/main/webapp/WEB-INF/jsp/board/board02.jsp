<%@page import="java.net.URLDecoder, java.net.URLEncoder"%>
<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %>
<%@ page import="java.util.*, beans.BoardBean, beans.CommentBean, beans.MemberBean, beans.BookBean" %>
<jsp:useBean id="bMgr" class="board.BoardMgr" />
<jsp:useBean id="dMgr" class="board.DateMgr" />
<%-- Í∏ÄÎ≥¥Í∏∞ ÌéòÏù¥ÏßÄ --%>
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>${post.title} | ÏùÄÌïòÏàòÏ±ÖÎ∞©</title>
  <link rel="stylesheet" href="${pageContext.request.contextPath}/css/reset copy 2.css?after">
  <link rel="stylesheet" href="${pageContext.request.contextPath}/css/board.css?after">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
  <script defer src="${pageContext.request.contextPath}/js/header.js"></script>
  <script defer src="${pageContext.request.contextPath}/js/board02.js"></script>
</head>
<body>
  <div id="wrap">
	  <jsp:include page="../components/header.jsp" />
	 
	  <section>
	    <h2><a href="./board01">ÏùÄÌïòÏàò Í¥ëÏû•‚ú®</a></h2>
	    
		<%-- statusÍ∞Ä 0Ïù∏ Í≤åÏãúÍ∏ÄÎßå ÎÇ¥Ïö©Ï∂úÎ†•, 9ÏùºÍ≤ΩÏö∞ alert ÌõÑ Î™©Î°ùÏúºÎ°ú Ïù¥Îèô --%>
		<c:choose>
			<c:when test="${empty post || post.status != 0}">
				<div id="postBox">
			    </div>
			    <script>
			    	alert("ÏÇ≠Ï†úÎêú Í≤åÏãúÍ∏ÄÏûÖÎãàÎã§.");
			    	location.href="board01";
			    </script>
			</c:when>
	    	<c:otherwise>
	    		<div id="postBox">
			    
			      <div id="readHead">
			        <div id="readHead-top">
			          <p id="readTit">${post.title}</p>
			        </div> <%--readHead-top--%>
			
			        <div id="readHead-bottom">
			          <div id="regInfo">
			            <span id="postAuthor">${post.nickname}</span>
			            <span id="postRegdate">${post.regdate}
			            <%-- ÏàòÏ†ïÎêêÏúºÎ©¥ ÎçßÎ∂ôÏûÑ --%>
			            <c:if test="${post.updateDate != null}">
			            	<span class="edited">(ÏàòÏ†ïÎê®)</span>
			            </c:if>
			            </span>
			          </div>
			
			          <div id="feedback">
			            <p>Ï°∞Ìöå <span>${post.count}</span></p>
			            <p>Ï∂îÏ≤ú <span>${liked}</span></p>
			            <p onclick="scrollFn('button')">ÎåìÍ∏Ä <span>${activeComCount}</span></p>
			          </div>
			        </div> <%--readHead-bottom--%>
			      </div> <%--readHead--%>
			
			      <div id="readContent">
			        <div id="contentDetail">
			          <%-- Ïù¥ÎØ∏ÏßÄÍ∞Ä Ï°¥Ïû¨ÌïòÎ©¥ Ï∂úÎ†• --%>
			          <c:if test="${post.photo != null}">
			          	<img src="data:image/jpeg;base64, ${post.encodedPhoto}" alt="${post.photoName}">
				        <br />
			          </c:if>
			          <p>
			          	<pre>${post.content}</pre>
			          </p>
			          <%-- ÏÑ†ÌÉùÌïú ÎèÑÏÑúÍ∞Ä Ï°¥Ïû¨ÌïòÎ©¥ Ï∂úÎ†• --%>
			          
			          <c:if test="${post.bookid > 0}">
			          	<div id="bookLink">
			          		<h4>üîç Ïù¥ÏïºÍ∏∞ Ï§ëÏù∏ Ï±ÖÏùÑ ÏïåÍ≥†Ïã∂Îã§Î©¥?</h4>
				          	<a href="/shop/shop02?bookid=${post.bookid}">
				          		<%-- Ï≤®Î∂ÄÏù¥ÎØ∏ÏßÄÍ∞Ä ÏûàÏúºÎ©¥ Ï∂úÎ†• --%>
				          		<c:choose>
				          			<c:when test="${book.getPhoto() != null}">
				          				<img src="data:image/jpeg;base64, ${book.encodedPhoto}" alt="${book.title}">
				          			</c:when>
				          			<c:otherwise>
				          				<img src="https://upload.wikimedia.org/wikipedia/commons/6/65/No-Image-Placeholder.svg" alt="${book.title}">
				          			</c:otherwise>
				          		</c:choose>
				          		<p>
				          			<span>${book.title}</span>
				          			<span>${book.author}</span>
				          		</p>
				          	</a>
			          	</div>
			          </c:if>
			        </div>
			
					<%-- Î°úÍ∑∏Ïù∏ ÏãúÏóêÎßå Í∏Ä Ï∂îÏ≤ú Í∞ÄÎä• --%>
					<c:choose>
						<c:when test="${loginId != null}">
							<p id="likeBtn" onclick="uplike(${num}, ${loginId}, this)">
						</c:when>
						<c:otherwise>
							<p id="likeBtn" onclick="alert('Î°úÍ∑∏Ïù∏Ïù¥ ÌïÑÏöîÌïú ÏÑúÎπÑÏä§ ÏûÖÎãàÎã§.')">
						</c:otherwise>
					</c:choose>
			        <span>${liked}</span>
			          <i class="fa-regular fa-thumbs-up"></i>
			        </p>
			      </div>
				 <%-- ÏûÑÏãú: Í∞úÎ∞úÏûêÏö© Ï∂îÏ≤úÎ≤ÑÌäº --%>
		       	 <button type="button" onclick="location.href='forDev/likebug?num=${num}'">Í∞úÎ∞úÏûêÏö©:Ï∂îÏ≤ú14Í∞ú(Ïù∏Í∏∞Í∏ÄÏùÄ15Í∞úÎ∂ÄÌÑ∞)</button>
		      	
				<%-- // ÎÇ¥Í∏ÄÏùº ÎïåÎßå ÏàòÏ†ï/ÏÇ≠Ï†úÎ≤ÑÌäº --%>
					<c:if test="${loginId != null}">
						<c:if test="${post.userid == loginId}">
							<div id="postMng">
						        <a href="board05?category=${category}&num=${num}" class="readBtn">ÏÇ≠Ï†ú <i class="fa-solid fa-trash-can"></i></a>
						        <a href="board03?category=${category}&num=${num}" class="readBtn">ÏàòÏ†ï <i class="fa-solid fa-pencil"></i></a>
					      	</div> <%--postMng--%>
						</c:if>
					</c:if>			      
			    </div> <%--postBox--%>
			    
				<div id="commentBox" class="commentBox-${num}">
			    
			      <div id="commentHead">
			        <div id="commentOpt">
			          <h3>ÎåìÍ∏Ä [<span>${activeComCount}</span>]</h3>
				          <select name="commentSort" id="commentSort" onchange="commentSort(this, ${num})">
				            <option value="Îì±Î°ùÏàú"">Îì±Î°ùÏàú</option>
				            <option value="ÏµúÏã†Ïàú">ÏµúÏã†Ïàú</option>
				          </select>
			        </div> <%-- div#commentOpt --%>
			
			        <div id="commentMng">
			          <span onclick="scrollFn('post')">Î≥∏Î¨∏Î≥¥Í∏∞</span>
			        </div> <%-- div#commentMng --%>
			      </div> <%--commentHead--%>
					
				  <div id="commentCont">
					  <%-- Ï∂îÏ∂úÎêú ÎåìÍ∏ÄÏù¥ ÏûàÏùÑÍ≤ΩÏö∞ --%>
					  <c:if test="${not empty clist}">
					  
					  	<c:forEach var="comment" items="${clist}" varStatus="status">
					  	
					  		<%-- ÌéòÏù¥ÏßÄÎãπ Î†àÏΩîÎìúÏàòÎßåÌÅº Ï∂úÎ†• --%>
					  		<c:if test="${status.index < paging.numPerPage}">
								<c:choose>
				  				
				  					<%-- status==0Ïù∏Í±¥ Ï†ïÏÉÅÏ∂úÎ†•/status=9Î©¥ÏÑú ÎåÄÎåìÏù¥ÏûàÎäîÍ±¥ ÎÇ¥Ïö©ÎåÄÏ≤¥Ï∂úÎ†•+Î≤ÑÌäºÎØ∏Ï∂úÎ†• --%>
									<c:when test="${comment.status==0}">
										<%-- ÎßåÏïΩ depthÍ∞Ä ÏûàÏúºÎ©¥ classÏóê depth-ÎéÅÏä§Í∞í Î∂ÄÏó¨ --%>
										<c:choose>
											<c:when test="${comment.depth > 0}">
												<div class="comment comment-${num} comid-${comment.commentid} depth depth-${comment.depth}">
											</c:when>
											<c:otherwise>
												<div class="comment comment-${num} comid-${comment.commentid}">
											</c:otherwise>
										</c:choose>
											<div class="commentInfo">
									          	<div class="authorInfo">
										            <%-- Í∏ÄÏûëÏÑ±ÏûêÏôÄ ÎåìÍ∏ÄÏûëÏÑ±ÏûêÍ∞Ä Í∞ôÏùÑÍ≤ΩÏö∞ ÏûëÏÑ±ÏûêÌëúÏãú --%>
										            <span class="commentAuthor ${(post.userid == comment.userid) ? 'same' : ''}">${comment.nickname}</span>
										            <%-- ÏóÖÎç∞Ïù¥Ìä∏ÏùºÏù¥ Ï°¥Ïû¨Ìï† Ïãú (ÏàòÏ†ïÎê®) Ï∂úÎ†• --%>
										            <c:if test="${comment.updateDate != null}">
										            	<span class="comUpdate">(ÏàòÏ†ïÎê®)</span>
										            </c:if>
									          	</div> <%-- .authorInfo --%>
									            
												<div class="commentAdd">
									              <span class="commentDate">${comment.regdate}</span>
									              
									              <%-- Î°úÍ∑∏Ïù∏ ÏãúÏóêÎßå ÎãµÍ∏ÄÎ≤ÑÌäº --%>
									              <c:if test="${loginId != null}">
									              	<div class="author-addOns">
													<span onclick="toggleReply(this);"><i class="fa-solid fa-reply" title="ÎãµÍ∏Ä"></i></span>
												 	<%-- ÎÇ¥ÎåìÍ∏ÄÏùº ÎïåÎßå ÏàòÏ†ï/ÏÇ≠Ï†úÎ≤ÑÌäº --%>
												 	<c:if test="${comment.userid == loginId }">
												 		<span onclick="toggleEdit(this);"><i class="fa-solid fa-pencil" title="ÎåìÍ∏ÄÏàòÏ†ï"></i></span>
									                	<span onclick="commentDelete(${comment.commentid}, ${loginId}, ${comment.pos}, ${num}, ${paging.end}, ${comment.userid}, ${paging.nowBlock}, ${paging.nowPage}, ${paging.pagePerBlock}, ${paging.totalPage})"><i class="fa-solid fa-trash-can" title="ÎåìÍ∏ÄÏÇ≠Ï†ú"></i></span>
												 	</c:if>
												 	</div> <%-- .author-addOns --%>
									              </c:if>
									              
												</div> <%-- commentAdd --%>
											</div> <%-- commentInfo --%>
									          
									        <div class="commentMsg">
									            <p class="text">${comment.content}</p>
											</div>
										</div> <%-- .comment --%>
								        
								        <%-- ÎåìÍ∏ÄÏàòÏ†ï Ìèº (Ïà®ÍπÄ/ÏàòÏ†ïÎ≤ÑÌäºÏúºÎ°ú ÌÜ†Í∏Ä) --%>
								        <form action="commentEdit" name="comEditFrm" id="comEditFrm" method="post" autocomplete="off" class="off">
									        <div id="writeComment">
									          <p class="commentAuthor">
									            <span>ÏàòÏ†ï</span>${loginNickname}
									          </p>
									          <textarea name="inputComment" placeholder="ÎåìÍ∏ÄÏùÑ ÏûëÏÑ±Ìï¥Î≥¥ÏÑ∏Ïöî!">${comment.content}</textarea>
									          <button type="button" onclick="editSubmit(${comment.commentid}, ${loginId}, '${loginNickname}', ${num}, '${userip}', ${paging.end}, ${comment.userid}, ${paging.nowBlock}, ${paging.nowPage}, ${paging.pagePerBlock}, ${paging.totalPage})">ÏàòÏ†ï</button>
									        </div>
										</form>
									        
								        <%-- ÎåÄÎåìÍ∏Ä Ìèº (Ïà®ÍπÄ/ÎãµÍ∏ÄÎ≤ÑÌäºÏúºÎ°ú ÌÜ†Í∏Ä) --%>
								        <form action="commentReply" name="replyFrm" id="replyFrm" method="post" autocomplete="off" class="off">
									        <div id="writeComment">
									          <p class="commentAuthor">
									            <span>ÎãµÍ∏Ä</span>${loginNickname}
									          </p>
									          <textarea name="inputComment" placeholder="ÎãµÍ∏ÄÏùÑ ÏûëÏÑ±Ìï¥Î≥¥ÏÑ∏Ïöî!"></textarea>
									          <button type="button" onclick="replySubmit(${comment.commentid}, ${loginId}, '${loginNickname}', ${num}, '${userip}', ${comment.commentid}, ${comment.depth}, ${comment.pos}, ${paging.end}, ${paging.nowBlock}, ${paging.nowPage}, ${paging.pagePerBlock}, ${paging.totalPage})">ÏûëÏÑ±</button>
									        </div>
										</form>
									</c:when> <%-- comment.status==0 --%>
								
									<%-- status=9Î©¥ÏÑú ÎåÄÎåìÏù¥ÏûàÎäîÍ±¥ ÎÇ¥Ïö©ÎåÄÏ≤¥Ï∂úÎ†•+Î≤ÑÌäºÎØ∏Ï∂úÎ†• --%>
									<c:otherwise>
										
										<%-- ÎßåÏïΩ depthÍ∞Ä ÏûàÏúºÎ©¥ classÏóê depth-ÎéÅÏä§Í∞í Î∂ÄÏó¨ --%>
										<c:choose>
											<c:when test="${comment.depth > 0}">
												<div class="comment comment-${num} comid-${comment.commentid} depth depth-${comment.depth}">
											</c:when>
											<c:otherwise>
												<div class="comment comment-${num} comid-${comment.commentid}">
											</c:otherwise>
										</c:choose>
										
								          <div class="commentMsg">
								            <p class="text">ÏÇ≠Ï†úÎêú ÎåìÍ∏ÄÏûÖÎãàÎã§.</p>
								          </div>
								        </div> <%-- .comment --%>
									</c:otherwise> <%--comment.status==0Í∞Ä ÏïÑÎãåÍ≤É--%>
								</c:choose>
					  			
					  		</c:if> <%-- if(status.index > paging.numPerPage) --%>
					  	</c:forEach> <%-- clist --%>
					  </c:if> <%--not empty clist --%>
				  </div> <%-- div#commentCont --%>
				
				<%-- ÌéòÏù¥ÏßÄÎÑ§Ïù¥ÏÖò --%>
				<%-- Í≤åÏãúÍ∏ÄÏù¥ Ï°¥Ïû¨ÌïúÎã§Î©¥ (paging.totalPage Í≤ÄÏÇ¨) ÌéòÏù¥ÏßÄÎÑ§Ïù¥ÏÖò ÏÉùÏÑ±(ÌòÑÏû¨Î∏îÎü≠Ïùò Ï≤´ÌéòÏù¥ÏßÄ~ÎÅùÌéòÏù¥ÏßÄ) --%>
				<c:if test="${paging.totalPage != 0}">
					<ul id="comPagination">
				        <%-- ÌòÑÏû¨ ÌéòÏù¥ÏßÄÎ∏îÎü≠Ïù¥ Ï≤´Î∏îÎü≠Ïù¥ ÏïÑÎãàÎùºÎ©¥ 'Ïù¥Ï†ÑÎ∏îÎü≠ÏúºÎ°ú', 'Ï≤òÏùåÌéòÏù¥ÏßÄÎ°ú' Î≤ÑÌäº ÏÉùÏÑ± --%>
				        <c:if test="${paging.nowBlock > 1}">
				        	<li class="pageBtn btnFirst" title="Ï≤´ ÌéòÏù¥ÏßÄÎ°ú" onclick="goComBlock(this, ${num}, ${paging.nowBlock}, ${paging.pagePerBlock}, ${paging.totalPage}, ${paging.end});"><i class="fa-solid fa-angles-left"></i></li>
					        <li class="pageBtn btnPrev" title="Ïù¥Ï†Ñ ÌéòÏù¥ÏßÄÎ°ú" onclick="goComBlock(this, ${num}, ${paging.nowBlock}, ${paging.pagePerBlock}, ${paging.totalPage}, ${paging.end});"><i class="fa-solid fa-angle-left"></i></li>
				        </c:if>
				        
				        <c:forEach var="nPage" begin="${paging.pageStart}" end="${paging.pageEnd - 1}">
						    <li onclick="goComPage(${num}, ${paging.nowBlock}, ${paging.pagePerBlock}, ${paging.totalPage}, ${nPage}, ${paging.end})"
						    	<%-- ÌÅ¥Î¶≠Ìïú ÌéòÏù¥ÏßÄÎÑ§Ïù¥ÏÖònPageÍ≥º ÌÅ¥Î¶≠Ïãú Ï†ÑÏÜ°Î∞õÏùÄ paging.nowPageÏôÄ Í∞ôÎã§Î©¥ Ïä§ÌÉÄÏùº Ï†ÅÏö©(liÏóê class="on") --%>
						        <c:if test="${paging.nowPage == nPage}">
						            class="on"
						        </c:if>
						    >
						        ${nPage}
						    </li>
						</c:forEach>
		        	
		        		<%-- ÌòÑÏû¨ ÌéòÏù¥ÏßÄÎ∏îÎü≠Ïù¥ ÎßàÏßÄÎßâÎ∏îÎü≠Ïù¥ ÏïÑÎãàÎùºÎ©¥ 'Îã§ÏùåÎ∏îÎü≠ÏúºÎ°ú', 'ÎßàÏßÄÎßâÌéòÏù¥ÏßÄÎ°ú' Î≤ÑÌäºÏÉùÏÑ± --%>
		        		<c:if test="${paging.totalBlock > paging.nowBlock}">
		        			<li class="pageBtn btnNext" title="Îã§Ïùå ÌéòÏù¥ÏßÄÎ°ú" onclick="goComBlock(this, ${num}, ${paging.nowBlock}, ${paging.pagePerBlock}, ${paging.totalPage}, ${paging.end});"><i class="fa-solid fa-angle-right"></i></li>
			          		<li class="pageBtn btnLast" title="ÎßàÏßÄÎßâ ÌéòÏù¥ÏßÄÎ°ú" onclick="goComBlock(this, ${num}, ${paging.nowBlock}, ${paging.pagePerBlock}, ${paging.totalPage}, ${paging.end});"><i class="fa-solid fa-angles-right"></i></li>
		        		</c:if>
					</ul> <%--#pagination--%>
				</c:if>	<%-- if(paging.totalPage != 0) --%>	        
			   
			   <c:choose>
			   		<%-- Î°úÍ∑∏Ïù∏ ÎêòÏñ¥ÏûàÏùÑ ÎïåÎßå ÎåìÍ∏ÄÌèº ÎÖ∏Ï∂ú --%>
					<c:when test="${loginId != null}">
						<form name="commentFrm" id="commentFrm" method="post" autocomplete="off">
					        <div id="writeComment">
					          <p class="commentAuthor">
					            ${loginNickname}
					          </p>
					          <textarea name="inputComment" placeholder="ÎåìÍ∏ÄÏùÑ ÏûëÏÑ±Ìï¥Î≥¥ÏÑ∏Ïöî!"></textarea>
					          <button type="button" onclick="comSubmit(${loginId}, '${loginNickname}', ${num}, '${userip}')">ÏûëÏÑ±</button>
					        </div>
						</form>
					</c:when>
					<c:otherwise>
						<div id="loginNotice">
							<p>Î°úÍ∑∏Ïù∏ Ïù¥ÌõÑÏóê ÎåìÍ∏ÄÏùÑ ÏûëÏÑ±Ìï† Ïàò ÏûàÏäµÎãàÎã§.</p>
							<a href="/login/login01">Î°úÍ∑∏Ïù∏ ÌïòÎü¨Í∞ÄÍ∏∞ üëâ</a>
						</div>
					</c:otherwise>
			   </c:choose>
			</div> <%--commentBox--%>
			    
			
		    <div id="btns">
		      <a href="./board01?category=${category}">Î™©Î°ù</a>
		      <%-- Î°úÍ∑∏Ïù∏ Í≤ÄÏÇ¨(session) Í≤∞Í≥ºÏóê Îî∞Î•∏ Í∏ÄÏì∞Í∏∞Î≤ÑÌäº --%>
		      <c:choose>
		      	<c:when test="${loginId != null}">
		      		<a href="./board04?category=${category}">Í∏ÄÏì∞Í∏∞</a>
		      	</c:when>
		      	<c:otherwise>
		      		<a href="#" onclick="goLogin()">Í∏ÄÏì∞Í∏∞</a>
		      	</c:otherwise>
		      </c:choose>
		    </div>
	    	</c:otherwise> <%-- when(post == null || status != 0)Ïùò otherwise --%>
		</c:choose>
			
		<form action="board02" method="get" name="pageFrm">
	    	<c:if test="${not (category == null || category == '')}">
			    <input type="hidden" name="category" value="${category}" />
			</c:if>
			<input type="hidden" name="num" value="${num}" />
			<c:if test="${paging.nowPage > 0}">
			    <input type="hidden" name="tab" value="${paging.nowPage}" />
			</c:if>
    		<input type="hidden" name="paging.nowPage" />
    	</form>
	  </section>
	  
	  <footer>
	    Ìë∏ÌÑ∞ÏòÅÏó≠
	  </footer>
  </div>
</body>
</html>